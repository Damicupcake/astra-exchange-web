<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="shortcut icon" href="https://i.imgur.com/ufHYGd9.png">
    <script defer src="/__/firebase/5.7.3/firebase-app.js"></script>
    <script defer src="/__/firebase/5.7.3/firebase-auth.js"></script>
    <script defer src="/__/firebase/5.7.3/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase.js"></script>
    <script defer src="/__/firebase/init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Nunito:600,700" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <title>Astra Exchange</title>
    <style>
      *,h1,h2 {
        font-family: Nunito;
        text-align: center;
        color: rgba(0, 0, 0, 0.8);
      }
      h2 {
        margin-top: 20px;
      }
      body {
        overflow: scroll;
      }
      button {
        width: 280px;
        margin-top: 30px;
        margin-bottom: 13px;
        background: lightgray;
      }
      #exchangeBox {
        height: 320px;
        width: 500px;
        margin: auto;
        margin-top: 30px;
      }
      #title {
        margin: auto;
        margin-top: 10px;
        margin-bottom: 30px;
        font-size: 50px;
        width: 60%;
      }
      #astrasToExchange {
        text-align: center;
        width: 300px;
        margin: auto;
        margin-top: 30px;
      }
      #deHeader {
        margin-top: 10px;
        margin-bottom: 20px;
      }
      #userDisplay, #wealthDisplay, #wealthLabel {
        font-size: 35px;
        font-weight: 700;
      }
      #wealthLabel, #wealthDisplay {
        margin-top: 10px;
        margin-right: 5px;
      }
      #userDisplay {
        margin-top: 20px;
      }
      #receiver {
        margin-top: -20px;
        width: 300px;
      }
      img {
        margin: auto;
      }
      .flexContainer {
        margin-top: -20px;
        display: flex;
        margin-bottom: -20px;
        justify-content: space-around;
      }
      #headerBox {
        margin-top: 10px;
        height: 150px;
      }
      #logo {
        margin-top: 20px;
        width: 150px;
        height: 150px;
        border-style: solid;
        border-color: lightgray;
      }
      #copyright {
        text-align: right;
        vertical-align: bottom;
        margin-right: 20px;
        font: Nunito;
      }
      #exchangeHistBox {
        height: 350px;
        width: 650px;
        border-style: solid;
        border-color: lightgray;
        margin-right: 80px;
        overflow: scroll;
      }
      #mainContainer {
        display: flex;
        justify-content: space-around;
      }
      #ehbLabel {
        margin-top: -400px;
        margin-left: 740px;
        border-style: solid;
        border-color: lightgray;
        width: 400px;
      }
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      ::-webkit-scrollbar-thumb {
        background: #888;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      #noteInput {
        width: 300px;
        margin: auto;
        margin-top: 30px;
      }
      #mainPage {
        display: flex;
        justify-content: space-around;
      }
      #ceModalLabel {
        font-size: 40px;
      }
      #modalContainer {
        position: absolute;
        top: 24vw;
        left: 50%;
        width: 700px;
        transform: translate(-50%, -50%);
      }
      #closeButton {
        margin-top: 5px;
        height: 40px;
        margin-bottom: 5px;
      }
      #vtButton {
        margin-top: 10px;
        width: 250px;
        display: block;
        text-align: center;
        margin: 0 auto;
      }
      .menuIcon {
        width: 80px;
        margin-left: 0px;
        margin-right: 0px;
        transition: outline-color 0.2s ease-out;
        outline-color: rgba(0, 0, 250, 0);
      }
      .menuIcon:hover {
        outline: solid;
        outline-color: rgba(0, 0, 250, 0.1);
      }
      #iconBar {
        margin-top: -66px;
        margin-left: 350px;
      }
      #pinInput {
        width: 280px;
        margin: auto;
      }
      #currentPin {
        margin-bottom: 20px;
      }
      #savePinButton {
        margin-top: 20px;
      }
      #userInterface {
        width: 70px;
        margin-bottom: 18px;
        margin-right: 10px;
      }
      .table {
        width: 480px;
      }
      #currentPV {
        margin-top: 20px;
        margin-bottom: 40px;
      }
      .midContainer {
        width: 10px;
        margin-top: -130px;
      }
      #preview {
        border-style: solid;
        border-color: lightgray;
      }
      #saleButton {
        margin-left: -125px;
        margin-bottom: 100px;
        height: 40px;
      }
      #configureButton {
        margin-top: 85px;
      }
      button {
        font-family: Nunito;
        width: 120px;
      }
      #configureSale {
        margin-right: 315px;
        margin-top: -165px;
      }
      input {
        margin-right: 10px;
        margin: auto;
        font-family: Nunito;
      }
      #compNameInput {
        margin-top: 15px;
        width: 300px;
      }
      #saveName {
        margin-bottom: 20px;
      }
      #selectIndustry {
        margin-top: 10px;
        width: 300px;
        font-family: Nunito;
      }
      .centerBox {
        width: 100%;
        align: center;
        text-align: center;
        display: flex;
        justify-content: center;
      }
      #sdButton {
        width: 200px;
        margin-top: 10px;
      }
      #eProducts {
        width: 300px;
        margin-top: 0px;
      }
      #plModalLabel {
        font-size: 40px;
      }
      #productTableConfig {
        width: 100%;
      }
      #plModalContent {
        position: absolute;
        top: 24vw;
        left: 50%;
        width: 700px;
        margin-top: 20px;
        transform: translate(-50%, -50%);
      }
      #sellingContainer {
        margin-top: 46px;
      }
      #productNameInput, #productQuantityInput, #productCostInput {
        width: 30%;
        display: inline;
      }
      #saveProductButton {
        width: 80%;
        margin-top: 20px;
      }
      #tableContainer {
        overflow: scroll;
        height: 500px;
      }
      #customerDataDisplay {
        margin-top: -5px;
      }
      #currentCNameDisplay {
        margin-top: -41px;
        margin-left: 500px;
      }
      #currentPidDisplay {
        margin-right: 500px;
      }
      #loadingData {
        text-align: left;
      }
      #companyInterface {
        opacity: 0;
        animation-name: appear;
        animation-duration: 3s;
        animation-fill-mode: forwards;
      }
      @keyframes appear {
        0% { opacity: 0; }
        30% { opacity: 0; }
        100% { opacity: 1; }
      }
      #alertDeveloper {
        margin-bottom: 10px;
        margin-top: 20px;
      }

      /* Checkbox Styling */
      .container {
        display: block;
        position: relative;
        padding-left: 35px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 22px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      /* Hide the browser's default checkbox */
      .container input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      /* Create a custom checkbox */
      .checkmark {
        position: absolute;
        top: 0;
        margin-left: 5px;
        left: 0;
        height: 25px;
        width: 25px;
        background-color: #eee;
      }

      /* On mouse-over, add a grey background color */
      .container:hover input ~ .checkmark {
        background-color: #ccc;
      }

      /* When the checkbox is checked, add a blue background */
      .container input:checked ~ .checkmark {
        background-color: #2196F3;
      }

      /* Create the checkmark/indicator (hidden when not checked) */
      .checkmark:after {
        content: "";
        position: absolute;
        display: none;
      }

      /* Show the checkmark when checked */
      .container input:checked ~ .checkmark:after {
        display: block;
      }

      /* Style the checkmark/indicator */
      .container .checkmark:after {
        left: 9px;
        top: 5px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 3px 3px 0;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
      }
      #openClModalButton {
        width: 200px;
        margin-top: -20px;
        vertical-align: middle;
      }
      #clModalContent {
        height: 600px;
        overflow: visible;
      }
      #displayInput {
        border-style: solid;
        border-color: lightgray;
        margin-top: 20px;
      }
      #saveLogoButton {
        width: 400px;
      }
      #epfpContent {
        height: 240px;
      }
      #enterPinInput {
        margin-top: 10px;
        font-size: 25px;
        color: rgba(0, 0, 0, 0.9);
      }
      #epfpTitle {
        font-size: 40px;
        margin-bottom: 70px;
      }
      #epfpExplain {
        margin-top: 20px;
      }
      #enterPinForPurchase {
        margin-top: 100px;
      }
    </style>
  </head>
  <body>
    <h1 id="loadingData">Loading Company Data...</h1>
    <div id="companyInterface">
      <div id="headerBox" class="flexContainer">
        <img id="logo" src="https://i.imgur.com/aLgqM1V.png"/>
      </div>
      <div id="iconBar">
        <img id="userInterface" onclick="window.location.href='main.html'" class="menuIcon" src="https://i.imgur.com/ufHYGd9.png">
        <img id="graphWorksIcon" onclick="window.location.href='investData.html?comp=index'" class="menuIcon" src="https://i.imgur.com/OM7iXc9.png">
      </div>
      <div id="configureSale"/>
        <button class="btn btn-light configureSale" id="configureButton" onclick="closeSellingMenu()">Configuring</button>
        <button class="btn btn-light configureSale" id="saleButton" onclick="openSellingMenu()">Selling</button>
      </div>
      <h1 id="title">Company Interface</h1>
      <button class="btn btn-primary" id="openClModalButton" onclick="openChangeLogoModal()">Change Logo</button>
      <h3 id="customerDataDisplay">
        <h3 id="currentPidDisplay"><i>No Product Selected!</i></h3>
        <h3 id="currentCNameDisplay"><i>No Customer Active!</i></h3>
      </h3>
      <h2 id="compTitle"></h2>
      <input class="form-control" id="compNameInput" placeholder="Change Company Name"/>
      <h2 id="compIndustry"></h2>
      <div class="centerBox">
        <select class="custom-select mr-sm-2" id="selectIndustry">
          <option value="Baked Pastries">Baked Pastries</option>
          <option value="Technology">Technology</option>
          <option value="Savory Foods">Savory Foods</option>
          <option value="Non-Tech Materialistic Products">Non-Tech Materialistic Products</option>
          <option value="Non-Baked Sweets">Non-Baked Sweets</option>
          <option value="Unspecified">Unspecified</option>
        </select>
      </div>
      <h5 id="alertDeveloper"></h5>
      <div class="centerBox">
        <button onclick="saveData()" id="sdButton" class="btn btn-primary">Save Configuration</button>
      </div>
      <h2 id="currentPV"></h2>
      <div class="flexContainer">
        <button class="btn btn-secondary" id="eProducts" onclick="openProductsConfig()">View And Edit Product List</button>
      </div>
      <div id="sellingContainer" class="flexContainer">
        <table id="productTable" class="table">
          <thead>
            <tr>
              <th scope="col">Product ID</th>
              <th scope="col">Name</th>
              <th scope="col">Price</th>
              <th scope="col">Quantity</th>
            </tr>
          </thead>
          <tbody id="productList">
          </tbody>
        </table>
        <video autoplay="autoplay" class="active" id="preview"></video>
      </div>
      </div>
      <div class="modal fade" id="productsConfig" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content" id="plModalContent">
            <div class="modal-header">
              <h5 class="modal-title" id="plModalLabel">Product Table</h5>
            </div>
            <div class="modal-body" id="tableContainer">
              <table id="productTableConfig" class="table">
                <thead>
                  <tr>
                    <th scope="col">Product ID</th>
                    <th scope="col">Name</th>
                    <th scope="col">Price</th>
                    <th scope="col">Quantity</th>
                  </tr>
                </thead>
                <tbody id="productListConfig">
                </tbody>
              </table>
              <input placeholder="Product Name" class="form-control" id="productNameInput">
              <input placeholder="Product Cost" class="form-control" type="Number" id="productCostInput">
              <button onclick="saveNewProduct()" class="btn btn-primary" id="saveProductButton">Save Product</button>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="changeLogo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" id="clModalContent">
          <div class="modal-header">
            <h5 class="modal-title" id="plModalLabel">Change Company Logo</h5>
          </div>
          <div class="modal-body" id="tableContainer">
            <input type="file" id="logoInput" class="form-control-file" onchange="previewFile()">
            <img id="displayInput">
            <button onclick="saveLogo()" class="btn btn-primary" id="saveLogoButton">Save Logo</button>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="closeClModal" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="enterPinForPurchase" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" id="epfpContent">
          <div class="modal-header">
            <h5 class="modal-title" id="epfpTitle">Enter Pin For Purchase</h5>
          </div>
          <div class="modal-body" id="tableContainer">
            <form autocomplete="off">
              <input type="password" id="enterPinInput" class="form-control" placeholder="Enter Pin">
            </form>
              <h5 id="epfpExplain"><i>Press 'Enter' To Submit Pin</i></h5>
          </div>
        </div>
      </div>
    </div>
    <script>
      let id = document.cookie
      const d = new Date()
      let name
      let enteredPin
      let pinInputActive=false
      let compBalance
      let user = []
      let customerWealth
      let productPrice
      let customerName
      let productSaves = {}
      let industryOC
      let compLogo
      let cardId
      let currentNewLogoData
      let idOfCurrentProduct
      let productData = {}
      let lastProductId = 1
      let cameraPermitted = false
      let companyWealth
      let reader = new FileReader()
      let scanner = new Instascan.Scanner({ video: document.getElementById('preview') })
      let currentSetting = 0

      $("#companyInterface").hide()
      $("#currentCNameDisplay").hide()
      $("#currentPidDisplay").hide()
      let config = {
        apiKey: "AIzaSyDOfmd3fntDblft3mhjccRiEggWu_t5fW0",
        authDomain: "astra-exchange.firebaseapp.com",
        databaseURL: "https://astra-exchange.firebaseio.com",
        projectId: "astra-exchange",
        storageBucket: "astra-exchange.appspot.com",
        messagingSenderId: "946665066699"
      }
      firebase.initializeApp(config)
      let defaultDatabase = firebase.database()
      let storage = firebase.storage()
      function deleteProduct(pId) {
        firebase.database().ref('companies/' + id + "/products/" + pId).remove().then(function() {
          loadCompData()
        })
      }
      function saveNewProduct() {
        const newProdName = document.getElementById("productNameInput").value
        const newProdCost = Number(document.getElementById("productCostInput").value)
        firebase.database().ref('companies/' + id + "/products").push({
          name: newProdName,
          cost: newProdCost,
          inStock: true
        }).then(function() {
          document.getElementById("productNameInput").value = ""
          document.getElementById("productCostInput").value = ""
          alert("Product Addition Successful!")
        })
      }
      function changeStock(pId) {
        const productDBId = pId.split("|")[0]
        const productNumId = pId.split("|")[1]
        const productDataList = productSaves[productNumId]
        const productName = productDataList[0]
        const productCost = productDataList[1]
        const productInStock = !productDataList[2]
        const checkValue = !document.getElementById(pId).checked
        console.log(checkValue)
        firebase.database().ref('companies/' + id + '/products/' + productDBId).set({
          name: productName,
          cost: productCost,
          inStock: !checkValue
        }).then(function() {
          console.log("Successful inStock change!")
        })
      }
      function loadCompData() {
        console.log("Loading Company Data...")
        let compData = firebase.database().ref('companies/' + id)
        compData.on('value', function(snapshot) {
            if (snapshot.val()) {
              document.getElementById("compNameInput").value = ""
              document.getElementById("productListConfig").innerHTML = ""
              document.getElementById("productList").innerHTML = ""

              name = snapshot.val().name
              compLogo = snapshot.val().logo ? snapshot.val().logo : "https://i.imgur.com/lBJXFA9.png"
              products = snapshot.val().products
              industryOC = snapshot.val().industry

              document.getElementById("logo").src = compLogo
              $("#selectIndustry").val(industryOC).select()
              document.getElementById("compTitle").innerHTML = name
              document.getElementById("compIndustry").innerHTML = "Industry: "+industryOC
              if (industryOC == "Unspecified") {
                document.getElementById("alertDeveloper").innerHTML = "<i>If your company's industry isn't listed, please inform Kai!</i>"
              } else {
                document.getElementById("alertDeveloper").innerHTML = ""
              }
              productSaves = {}
              lastProductId = 1
              try {
                if (products) {
                  for (target of Object.keys(products)) {
                      const currentProduct = products[target]
                      const productName = currentProduct.name
                      const productCost = currentProduct.cost
                      const productInStock = currentProduct.inStock
                      const newProductSave = [productName, productCost, productInStock]
                      productSaves[lastProductId] = newProductSave
                      const newProductDisplay = document.createElement("tr")
                      const productIdDisplay = document.createElement("th")
                      const productNameDisplay = document.createElement("th")
                      const productCostDisplay = document.createElement("th")
                      const productInStockDisplay = document.createElement("th")
                      const buttonContainer = document.createElement("th")
                      const deleteButton = document.createElement("button")

                      const newCheckBoxContainer = document.createElement("label")
                      const newCheckBox = document.createElement("input")
                      const newCheckMark = document.createElement("span")

                      newCheckBoxContainer.className = "container"
                      newCheckBox.type = "checkbox"
                      newCheckMark.className = "checkmark"
                      newCheckBox.id = target+"|"+lastProductId
                      newCheckBox.onclick = function() { changeStock(this.id) }

                      newCheckBoxContainer.appendChild(newCheckBox)
                      newCheckBoxContainer.appendChild(newCheckMark)

                      productIdDisplay.innerHTML = lastProductId
                      productNameDisplay.innerHTML = productName
                      productCostDisplay.innerHTML = productCost+"A"
                      newCheckBox.checked = productInStock
                      productInStockDisplay.innerHTML = productInStock ? "In Stock" : "Sold Out"
                      newProductDisplay.style.textDecoration = productInStock ? "" : "line-through"
                      deleteButton.innerHTML = "X"
                      deleteButton.style.marginBottom = "0px"
                      deleteButton.style.marginTop = "0px"
                      deleteButton.style.height = "40px"
                      deleteButton.className = "btn btn-danger"
                      deleteButton.id = target
                      deleteButton.setAttribute('onclick','deleteProduct(this.id)')
                      deleteButton.style.width = "100%"
                      buttonContainer.appendChild(deleteButton)

                      newProductDisplay.appendChild(productIdDisplay)
                      newProductDisplay.appendChild(productNameDisplay)
                      newProductDisplay.appendChild(productCostDisplay)
                      newProductDisplay.appendChild(productInStockDisplay)
                      const modalList = newProductDisplay.cloneNode(true)
                      modalList.appendChild(newCheckBoxContainer)
                      modalList.appendChild(buttonContainer)
                      document.getElementById("productListConfig").appendChild(modalList)
                      document.getElementById("productList").appendChild(newProductDisplay)
                      lastProductId += 1
                  }
                }
              } catch(error) {
                alert("There has been an error! '" + error + "'")
              }
              $("#companyInterface").show()
              $("#loadingData").hide()
              lastProductId += 1
              recievedBalance = true
              } else {
                document.getElementById("loadingData").innerHTML = "No Company Data Exists! Go and Alert Ken that He Fudged With The Database!"
              }
            })
        }
      scanner.addListener('scan', function (content) {
        cardId = CryptoJS.AES.decrypt(content, "1r80823f8u2380r0h82f0hdobufhaw-qji2edjqwidnbq39r02qbf").toString(CryptoJS.enc.Utf8)
        return firebase.database().ref('cards/' + cardId).once('value').then(function(snapshot) {
          const customerId = snapshot.val()
          if (customerId == id) {
            alert("Stop trying to buy your own products to make yourself feel more popular, you fool!")
          } else {
            if (customerId) {
              return firebase.database().ref('users/' + customerId).once('value').then(function(snapshot) {
                if (idOfCurrentProduct) {
                  customerWealth = snapshot.val().balance
                  productPrice = Number(productSaves[idOfCurrentProduct][1])

                  if (customerWealth >= productPrice) {
                    customerWealth = Number(snapshot.val().balance)
                    customerName = snapshot.val().name
                    document.getElementById("currentCNameDisplay").innerHTML = customerName
                    $("#enterPinForPurchase").modal("show")
                    pinInputActive = true
                  } else {
                    alert("You lack sufficient funds to purchase this product! Wealth : " + customerWealth + "A")
                  }
                } else {
                  alert("A product has yet to be selected!")
                }
              })
            } else {
              alert("This card's id does not exist in the database! Please alert Kai he fudged up!")
            }
          }
        })
      })
      function closeSellingMenu() {
        currentSetting = 0
        console.log("Closing Down...")
        document.getElementById("title").innerHTML = "Company Configurations"
        $("#openClModalButton").show()
        $("#currentCNameDisplay").hide()
        $("#currentPidDisplay").hide()
        $("#compTitle").show()
        $("#selectIndustry").show()
        $("#compTitle").show()
        $("#sdButton").show()
        $("#compNameInput").show()
        $("#currentPV").show()
        $("#compIndustry").show()
        $("#preview").hide()
        $("#productTable").hide()
        $("#eProducts").show()
        $("#alertDeveloper").show()
      }
      function openSellingMenu() {
        if (!cameraPermitted) {
          Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
              cameraPermitted = true
              scanner.start(cameras[0])
              document.getElementById("preview").style.background = ""
              currentSetting = 1
              document.getElementById("title").innerHTML = name
              openSellingMenuDisplays()
            } else {
              alert("No cameras found!")
            }
          }).catch(function (e) {
            closeSellingMenu()
          })
        }
        if (cameraPermitted) {
          openSellingMenuDisplays()
        } else {
          alert("Your camera must be enabled for debit card scanning!")
        }
      }
      function openSellingMenuDisplays() {
        console.log("Selling!")
        $("#alertDeveloper").hide()
        $("#openClModalButton").hide()
        $("#currentCNameDisplay").show()
        $("#currentPidDisplay").show()
        $("#customerDataDisplay").show()
        $("#compNameInput").hide()
        $("#selectIndustry").hide()
        $("#compTitle").hide()
        $("#currentPV").hide()
        $("#compIndustry").hide()
        $("#preview").show()
        $("#sdButton").hide()
        $("#productTable").show()
        $("#eProducts").hide()
      }
      function saveData() {
        let newIndustry = document.getElementById("selectIndustry").value
        let newName = document.getElementById("compNameInput").value

        if (newName) {
          name = newName
        }
        products = products ? products : ""
        firebase.database().ref('companies/' + id).set({
          industry: newIndustry,
          name: name,
          products: products,
          logo: compLogo
        })
      }
      function openProductsConfig() {
        $("#productsConfig").modal("show")
      }
      function openChangeLogoModal() {
        $("#changeLogo").modal("show")
      }
      document.onkeydown = function(e){
          e = e || window.event
          let selected = false
          let key = e.which || e.keyCode
          key = key - 48
          //48 (0) to 57 (9)
          console.log("Key: "+key)
          if (Object.keys(productSaves).includes(key+"") && currentSetting == 1) {
            idOfCurrentProduct = key
            if (productSaves[idOfCurrentProduct][2]) {
              document.getElementById("currentPidDisplay").innerHTML = "<i>"+productSaves[idOfCurrentProduct][0]+" : "+productSaves[idOfCurrentProduct][1]+"A"+"</i>"
            }
          } else {
            if (key == -35) {
              if (pinInputActive) {
                enteredPin = document.getElementById("enterPinInput").value
                if (enteredPin) {
                  $("#enterPinForPurchase").modal("hide")
                  document.getElementById("enterPinInput").value = ""
                  const confirmConfidence = confirm("Are you sure you would like to purchase a \""+productSaves[idOfCurrentProduct][0]+"\" for "+productPrice+"A?")
                  document.getElementById("currentCNameDisplay").innerHTML = customerName
                  if (confirmConfidence) {
                      try {
                        return firebase.database().ref('users/' + id + "/balance").once('value').then(function(snapshot) {
                          companyWealth = Number(snapshot.val())
                          const oldCompanyWealth = companyWealth
                          const newCompWealth = companyWealth+productPrice
                          const newCustomerWealth = customerWealth-productPrice

                          firebase.database().ref("pending").push({
                            time: getDate(),
                            from: cardId,
                            to: id,
                            amount: productPrice,
                            balance: newCustomerWealth,
                            message: "Product Purchase",
                            pin: enteredPin
                          }).then(function(snapshot) {
                            return firebase.database().ref('users/' + id + "/balance").once('value').then(function(snapshot) {
                              let alertMessage

                              if (newCustomerWealth == 0) {
                                alertMessage = "The transaction was successful, but you are now bankrupt! Now go and work hard to get back up the socio-economic ladder!"
                              } else {
                                const pluralExtension = newCustomerWealth > 1 ? "s!" : "!"
                                alertMessage = "Your transaction was successful! You now have " + newCustomerWealth + " Astra" + pluralExtension
                              }
                              alert(alertMessage)
                              document.getElementById("enterPinInput").value = ""
                              document.getElementById("currentCNameDisplay").innerHTML = "<i>No Customer Active!</i>"
                              document.getElementById("currentPidDisplay").innerHTML = "<i>No Product Selected!</i>"

                              idOfCurrentProduct = undefined
                            })
                          })
                        })
                      }
                      catch(error) {
                        alert("Your pin is incorrect! Please re-enter it and try again!")
                        document.getElementById("enterPinInput").value = ""
                        document.getElementById("currentCNameDisplay").innerHTML = "<i>No Customer Active!</i>"
                        document.getElementById("currentPidDisplay").innerHTML = "<i>No Product Selected!</i>"

                        idOfCurrentProduct = undefined
                      }
                  } else {
                    alert("Purchase Cancelled!")
                  }
                } else {
                  alert("You haven't entered a pin yet!")
                }
              }
            }
          }
      }
      function previewFile() {
        let preview = document.createElement("img")
        let file = document.getElementById("logoInput").files[0]

        const imgData = reader.readAsDataURL(file)

        reader.onload = function(e) {

          currentNewLogoData = e.target.result
          document.getElementById("displayInput").src = currentNewLogoData
        }
      }
      function saveLogo() {
        if (currentNewLogoData) {
          let file = document.getElementById("logoInput").files[0]

          products = products ? products : ""
          firebase.database().ref("companies/" + id).set({
            logo: currentNewLogoData,
            industry: industryOC,
            name: name,
            products: products
          }).then(function() {
            alert("Success!")
            document.getElementById("logo").src = currentNewLogoData
            document.getElementById("closeClModal").click()
          })
        } else {
          alert("No file data exists!")
        }
      }
      function getDate() {
    		const dateList = Date().split(" ")
    		let timeOfDay = " AM"
    		const dateTime = (dateList[4].split(":")[0] % 12)+":"+dateList[4].split(":")[1]
    		if (dateList[4].split(":")[0] > 11) {
    		timeOfDay = " PM"
    		}
    		return dateList[1]+" "+dateList[2]+", "+dateList[3]+" @ "+dateTime+timeOfDay
    	}
      $('form').on('submit', function(event){
        event.preventDefault()
      })
      closeSellingMenu()
      loadCompData()
    </script>
  </body>
</html>
